<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Transformation</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>

<script>
// Load both CSV files
Promise.all([
    d3.csv("../figure_data/gefahr_counts.csv"),
    d3.csv("../figure_data/gefahr_treiber_counts.csv")
]).then(([gefahrCounts, treiberCounts]) => {
  // Merge the data on 'id' and 'gefahr_id'
  const mergedData = gefahrCounts.map(count => ({
    ...count,
    ...treiberCounts.find(treiber => treiber.gefahr_id === count.id)
  }));


    // Convert the merged data to the desired structure
    const result = mergedData.map(entry => {
    const { id, count, bezeichnung_de, mean_sterne, gefahr_id, ...treiberColumns } = entry;
    const treiber = Object.keys(treiberColumns).reduce((acc, key) => {
      acc[key] = +treiberColumns[key];
      return acc;
    }, {});

    return {
        id: +id,
        name: bezeichnung_de,
        count: +count,
        mean_sterne: +mean_sterne,
        treiber: treiber
    };
  });

    // Define the number of colors you want
    const numberOfColors = 13;

    // Choose a D3 color scale (e.g., d3.schemeCategory10, d3.schemeSet3, etc.)
    const colorScale = d3.scaleOrdinal(d3.schemeCategory13);
    const colorRange = d3.range(numberOfColors).map(colorScale);

    var ordinal = d3.scaleOrdinal()
      .domain( ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13' ] )
      .range(colorRange);
  
  // Print or use 'result' as needed
  console.log(ordinal)
  console.log(result);
}).catch(error => {
  console.error("Error loading CSV files:", error);
});
</script>

</body>
</html>
